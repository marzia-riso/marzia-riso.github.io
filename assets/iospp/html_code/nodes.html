
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Optimization of Scaffolded Procedural Patterns - Code Visualization</title>
    <style>
        body {
            font-family: Helvetica, Arial, sans-serif;
            line-height: 1.6;
            width: 960px;
            margin: 0 auto;
        }
pre { white-space: pre; overflow: auto; }
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body>
  <h1>Interactive Optimization of Scaffolded Procedural Patterns</h1>
  <h2>Code for Nodes</h2>
  <div><img width="960px" src="../graphs/nodes.png"></div>
  <div width="960px"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;helper_math.h&gt;</span><span class="c1"> </span>

<span class="cp">#define M_PI 3.1415926535</span>
<span class="cp">#define PI_2 (M_PI * 2.0)</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">AddIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">AddOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">AddOut</span><span class="w"> </span><span class="n">AddImpl</span><span class="p">(</span><span class="n">AddIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">AddOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Add2fIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Add2fOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">Add2fOut</span><span class="w"> </span><span class="n">Add2fImpl</span><span class="p">(</span><span class="n">Add2fIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Add2fOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">y</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">MulIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">MulOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">MulOut</span><span class="w"> </span><span class="n">MulImpl</span><span class="p">(</span><span class="n">MulIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">MulOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Mul2fIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Mul2fOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">Mul2fOut</span><span class="w"> </span><span class="n">Mul2fImpl</span><span class="p">(</span><span class="n">Mul2fIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Mul2fOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">y</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">DivIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">DivOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">DivOut</span><span class="w"> </span><span class="n">DivImpl</span><span class="p">(</span><span class="n">DivIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">DivOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Div2fIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Div2fOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">Div2fOut</span><span class="w"> </span><span class="n">Div2fImpl</span><span class="p">(</span><span class="n">Div2fIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Div2fOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">y</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">SubIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">SubOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">SubOut</span><span class="w"> </span><span class="n">SubImpl</span><span class="p">(</span><span class="n">SubIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">SubOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Sub2fIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Sub2fOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">Sub2fOut</span><span class="w"> </span><span class="n">Sub2fImpl</span><span class="p">(</span><span class="n">Sub2fIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Sub2fOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">y</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">NormalizeIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value3</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">NormalizeOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">NormalizeOut</span><span class="w"> </span><span class="n">NormalizeImpl</span><span class="p">(</span><span class="n">NormalizeIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">NormalizeOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value3</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Normalize2fIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value3</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Normalize2fOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">Normalize2fOut</span><span class="w"> </span><span class="n">Normalize2fImpl</span><span class="p">(</span><span class="n">Normalize2fIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Normalize2fOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value3</span><span class="p">.</span><span class="n">y</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">NegIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">NegOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">NegOut</span><span class="w"> </span><span class="n">NegImpl</span><span class="p">(</span><span class="n">NegIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">NegOut</span><span class="p">{</span><span class="o">-</span><span class="n">input_</span><span class="p">.</span><span class="n">x</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">ToVec2In</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">ToVec2Out</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">ToVec2Out</span><span class="w"> </span><span class="n">ToVec2Impl</span><span class="p">(</span><span class="n">ToVec2In</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ToVec2Out</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">y</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">FromVec2In</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FromVec2Out</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">FromVec2Out</span><span class="w"> </span><span class="n">FromVec2Impl</span><span class="p">(</span><span class="n">FromVec2In</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">FromVec2Out</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">RoundIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">RoundOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">RoundOut</span><span class="w"> </span><span class="n">RoundImpl</span><span class="p">(</span><span class="n">RoundIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">RoundOut</span><span class="p">{</span><span class="n">round</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">value</span><span class="p">)};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">CircleIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">inner</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">CircleOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">CircleOut</span><span class="w"> </span><span class="n">CircleImpl</span><span class="p">(</span><span class="n">CircleIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">inner</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">inner</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">circle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">CircleOut</span><span class="p">{</span><span class="n">abs</span><span class="p">(</span><span class="n">circle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">inner</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">inner</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">BoxIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">BoxOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">BoxOut</span><span class="w"> </span><span class="n">BoxImpl</span><span class="p">(</span><span class="n">BoxIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">BoxOut</span><span class="p">{</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">radius</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">JointIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">curvature</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">JointOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">JointOut</span><span class="w"> </span><span class="n">JointImpl</span><span class="p">(</span><span class="n">JointIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">float2</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">};</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">curvature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">curvature</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">curvature</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.001</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">clamp</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JointOut</span><span class="p">{</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_float2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">curvature</span><span class="p">),</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">curvature</span><span class="p">));</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">curvature</span><span class="p">;</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">ra</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">));</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">make_float2</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">q</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">JointOut</span><span class="p">{</span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">thickness</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">StripeIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">StripeOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">StripeOut</span><span class="w"> </span><span class="n">StripeImpl</span><span class="p">(</span><span class="n">StripeIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">sdfStripeY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">StripeOut</span><span class="p">{</span><span class="n">sdfStripeY</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">TriangleWaveIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">frequence</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">amplitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">TriangleWaveOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">TriangleWaveMod</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">TriangleWaveOut</span><span class="w"> </span><span class="n">TriangleWaveImpl</span><span class="p">(</span><span class="n">TriangleWaveIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">frequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">frequence</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">amplitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">amplitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">;</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">pw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">frequence</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">qw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pw</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_float2</span><span class="p">(</span><span class="mf">4.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">amplitude</span><span class="p">,</span><span class="w"> </span><span class="n">pw</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">posX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">TriangleWaveMod</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qw</span><span class="p">,</span><span class="w"> </span><span class="n">pw</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pw</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qw</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">posX1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">posX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">posY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">posX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>

<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_float2</span><span class="p">(</span><span class="n">posX1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">posY</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">l</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">TriangleWaveOut</span><span class="p">{</span><span class="n">length</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">thickness</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">SineWaveIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">frequence</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">amplitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">SineWaveOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">SineWaveMod</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">Sign</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">-1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">SineWaveOut</span><span class="w"> </span><span class="n">SineWaveImpl</span><span class="p">(</span><span class="n">SineWaveIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">frequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">frequence</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">amplitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">amplitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">;</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frequence</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">amplitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">amplitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">py</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">amplitude</span><span class="p">;</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>

<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_float2</span><span class="p">(</span><span class="n">SineWaveMod</span><span class="p">(</span><span class="n">px</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">py</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Sign</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SineWaveMod</span><span class="p">(</span><span class="n">px</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">)));</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fminf</span><span class="p">(</span><span class="n">fmaxf</span><span class="p">((</span><span class="mf">0.818309886184</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">0.669631069826</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="p">);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cosf</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinf</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="p">((</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">sine_wave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrtf</span><span class="p">((</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">sinf</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">sinf</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">amplitude</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">SineWaveOut</span><span class="p">{</span><span class="n">abs</span><span class="p">(</span><span class="n">sine_wave</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">thickness</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">InterpolationIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">interpolation</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">InterpolationOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">InterpolationOut</span><span class="w"> </span><span class="n">InterpolationImpl</span><span class="p">(</span><span class="n">InterpolationIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">InterpolationOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">interpolation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="p">)};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">GridIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">GridOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">GridOut</span><span class="w"> </span><span class="n">GridImpl</span><span class="p">(</span><span class="n">GridIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">sdfStripeX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">sdfStripeY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GridOut</span><span class="p">{</span><span class="n">min</span><span class="p">(</span><span class="n">sdfStripeX</span><span class="p">,</span><span class="w"> </span><span class="n">sdfStripeY</span><span class="p">)};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">HoneycombGridIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">HoneycombGridOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">Fract</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">HoneycombGridOut</span><span class="w"> </span><span class="n">HoneycombGridImpl</span><span class="p">(</span><span class="n">HoneycombGridIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">py</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.7320508076</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Fract</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">py</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">px_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">Fract</span><span class="p">(</span><span class="n">px</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">py_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">Fract</span><span class="p">(</span><span class="n">py</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">sdf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">px_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">py_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">px_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">HoneycombGridOut</span><span class="p">{</span><span class="n">sdf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">RadialRepetitionIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">theta</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">RadialRepetitionOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position2</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">RadialRepetitionOut</span><span class="w"> </span><span class="n">RadialRepetitionImpl</span><span class="p">(</span><span class="n">RadialRepetitionIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">angle</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">theta</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">distance</span><span class="p">;</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atan2</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">angle</span><span class="p">);</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">c1</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">c1</span><span class="p">);</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">p1XTra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">p2XTra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">RadialRepetitionOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">p1XTra</span><span class="p">,</span><span class="w"> </span><span class="n">p1Y</span><span class="p">},</span><span class="w"> </span><span class="kt">float2</span><span class="p">{</span><span class="n">p2XTra</span><span class="p">,</span><span class="w"> </span><span class="n">p2Y</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">RadialLineIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">theta</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">RadialLineOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">RadialLineDist</span><span class="p">(</span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="kt">float2</span><span class="w"> </span><span class="n">ba_</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ba_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ba_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">-2.0</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">pa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="w"> </span><span class="n">ba</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="w"> </span><span class="n">ba</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">RadialLineOut</span><span class="w"> </span><span class="n">RadialLineImpl</span><span class="p">(</span><span class="n">RadialLineIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">theta</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">angle</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atan2</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">angle</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">theta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">edge</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">angle</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">float2</span><span class="p">{</span><span class="n">cos</span><span class="p">(</span><span class="n">step</span><span class="p">),</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">step</span><span class="p">)};</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RadialLineDist</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">RadialLineOut</span><span class="p">{</span><span class="n">abs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">thickness</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">TruchetIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">thickness</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">rotation</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">TruchetOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">TruchetOut</span><span class="w"> </span><span class="n">TruchetImpl</span><span class="p">(</span><span class="n">TruchetIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">floorf</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="n">Fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="w"> </span><span class="n">make_float2</span><span class="p">(</span><span class="mf">141.213</span><span class="p">,</span><span class="w"> </span><span class="mf">289.867</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">43758.5453</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">rotation</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">-1.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">Sign</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">  </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">thickness</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">TruchetOut</span><span class="p">{</span><span class="n">d</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">RotationIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">RotationOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">RotationOut</span><span class="w"> </span><span class="n">RotationImpl</span><span class="p">(</span><span class="n">RotationIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">angle</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">xRot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">yRot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">RotationOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">xRot</span><span class="p">,</span><span class="w"> </span><span class="n">yRot</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">TranslationIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">translation</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">TranslationOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">TranslationOut</span><span class="w"> </span><span class="n">TranslationImpl</span><span class="p">(</span><span class="n">TranslationIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">translation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">translation</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">TranslationOut</span><span class="p">{</span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">translation</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">ScaleIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">scale</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">ScaleOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">ScaleOut</span><span class="w"> </span><span class="n">ScaleImpl</span><span class="p">(</span><span class="n">ScaleIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">scale</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ScaleOut</span><span class="p">{</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">scale</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">RepetitionIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">space</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">RepetitionOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">RepetitionMod</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">RepetitionOut</span><span class="w"> </span><span class="n">RepetitionImpl</span><span class="p">(</span><span class="n">RepetitionIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">space</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">repPosX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RepetitionMod</span><span class="p">((</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">repPosY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RepetitionMod</span><span class="p">((</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="n">y</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">RepetitionOut</span><span class="p">{</span><span class="kt">float2</span><span class="p">{</span><span class="n">repPosX</span><span class="p">,</span><span class="w"> </span><span class="n">repPosY</span><span class="p">}};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Combine2In</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">scale1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">offset1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">scale2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">offset2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Combine2Out</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">Combine2Out</span><span class="w"> </span><span class="n">Combine2Impl</span><span class="p">(</span><span class="n">Combine2In</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Combine2Out</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">value1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">scale1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">offset1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                        </span><span class="n">input_</span><span class="p">.</span><span class="n">value2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">scale2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">offset2</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">CircleOnionIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">inner</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">step</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">CircleOnionOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">CircleOnionOut</span><span class="w"> </span><span class="n">CircleOnionImpl</span><span class="p">(</span><span class="n">CircleOnionIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">inner</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">inner</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">step</span><span class="p">);</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">circle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">circle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">inner</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inner</span><span class="p">;</span>
<span class="w">  </span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.025</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">sdf_circle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">inner</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">sdf_circle_inner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">sdf_circle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">sdf_circle_inner</span><span class="p">);</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">CircleOnionOut</span><span class="p">{</span><span class="n">distance</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">OverIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float3</span><span class="w"> </span><span class="n">color1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float3</span><span class="w"> </span><span class="n">color2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">OverOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float3</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define OVER_THICKNESS 0.0025</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OverBorderSdf</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sdf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">sdf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">OVER_THICKNESS</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OVER_THICKNESS</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OverInnerSdf</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sdf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sdf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OVER_THICKNESS</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">OverOut</span><span class="w"> </span><span class="n">OverImpl</span><span class="p">(</span><span class="n">OverIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">OverBorderSdf</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">));</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OverInnerSdf</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">distance2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">OverOut</span><span class="p">{</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">color1</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">OverOut</span><span class="p">{</span><span class="n">distance2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">color2</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">OverIdIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">OverIdOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define OVERID_THICKNESS 0.0025</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OverIdBorderSdf</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sdf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">sdf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">OVERID_THICKNESS</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OVERID_THICKNESS</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OverIdInnerSdf</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sdf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sdf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OVERID_THICKNESS</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">OverIdOut</span><span class="w"> </span><span class="n">OverIdImpl</span><span class="p">(</span><span class="n">OverIdIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">OverIdBorderSdf</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">));</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OverIdInnerSdf</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">distance2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">OverIdOut</span><span class="p">{</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid1</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">OverIdOut</span><span class="p">{</span><span class="n">distance2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid2</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">UnionIdIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">UnionIdOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">UnionIdOut</span><span class="w"> </span><span class="n">UnionIdImpl</span><span class="p">(</span><span class="n">UnionIdIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UnionIdOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid1</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UnionIdOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid2</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">DifferenceIdIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">DifferenceIdOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">DifferenceIdOut</span><span class="w"> </span><span class="n">DifferenceIdImpl</span><span class="p">(</span><span class="n">DifferenceIdIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">DifferenceIdOut</span><span class="p">{</span><span class="o">-</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid1</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">DifferenceIdOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid2</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">IntersectionIdIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid2</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">IntersectionIdOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">IntersectionIdOut</span><span class="w"> </span><span class="n">IntersectionIdImpl</span><span class="p">(</span><span class="n">IntersectionIdIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">IntersectionIdOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid1</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">IntersectionIdOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid2</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">ScaffoldIdIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">view_scaffold</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">ScaffoldIdOut</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define SCAFFOLDEDOVERID_THICKNESS 0.0025</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">ScaffoldIdBorderSdf</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sdf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">sdf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SCAFFOLDEDOVERID_THICKNESS</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SCAFFOLDEDOVERID_THICKNESS</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">ScaffoldIdInnerSdf</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sdf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sdf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SCAFFOLDEDOVERID_THICKNESS</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">__device__</span><span class="w"> </span><span class="kr">__forceinline__</span><span class="w"> </span><span class="n">ScaffoldIdOut</span><span class="w"> </span><span class="n">ScaffoldIdImpl</span><span class="p">(</span><span class="n">ScaffoldIdIn</span><span class="w"> </span><span class="n">input_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">view_scaffold</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ScaffoldIdOut</span><span class="p">{</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid2</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">ScaffoldIdBorderSdf</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">));</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScaffoldIdInnerSdf</span><span class="p">(</span><span class="n">input_</span><span class="p">.</span><span class="n">distance2</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">distance2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ScaffoldIdOut</span><span class="p">{</span><span class="n">distance1</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid1</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ScaffoldIdOut</span><span class="p">{</span><span class="n">distance2</span><span class="p">,</span><span class="w"> </span><span class="n">input_</span><span class="p">.</span><span class="n">levelid2</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level1Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level2Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level3Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level4Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level5Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level6Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level7Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level8Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level9Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Level10Output</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">levelid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">PositionInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">view_scaffold</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</body>
</html>
